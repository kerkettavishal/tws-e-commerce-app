name: tws-e-commerce-app Pipeline
on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:

permissions:
  contents: write 

jobs: 
    trivy:
      
      runs-on: ubuntu-latest
      env:
          DOCKER_USERNAME: joakim077
          
      steps:
        - name: Checkout Code
          uses: actions/checkout@v4


        - name: Unit testing
          run: |
            echo "Unit testing"
        
        - name: build docker Image
          run: |
            docker build -t myapp .

        - name: Run Trivy scan
          uses: aquasecurity/trivy-action@master
          with:
            image-ref: "myapp"
            format: "table"
            exit-code: 1
            ignore-unfixed: true
            severity: "CRITICAL,HIGH"
  
        - name: Upload Trivy scan results to GitHub Security tab
          # uses: github/codeql-action/upload-sarif@v3
          # with:
          #     sarif_file: 'trivy-results.sarif'
          run: ls
